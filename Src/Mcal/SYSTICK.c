/**********************************************************************************************************************
 *  FILE DESCRIPTION
 *  -----------------------------------------------------------------------------------------------------------------*/
/**        \file  SYSTICK.c
 *        \brief  SysTick timer
 *
 *				\Author: Andrew Bahaa
 *
 *      \details  The Driver Configure All MCU Timers for specific usage
 *
 *********************************************************************************************************************/


/**********************************************************************************************************************
 *  INCLUDES
 *********************************************************************************************************************/

#include "SYSTICK.h"

/**********************************************************************************************************************
*  LOCAL MACROS CONSTANT\FUNCTION
*********************************************************************************************************************/	

#define F_CPU 16000000

/**********************************************************************************************************************
 *  LOCAL DATA 
 *********************************************************************************************************************/

/**********************************************************************************************************************
 *  GLOBAL DATA
 *********************************************************************************************************************/

/**********************************************************************************************************************
 *  LOCAL FUNCTION PROTOTYPES
 *********************************************************************************************************************/

/**********************************************************************************************************************
 *  LOCAL FUNCTIONS
 *********************************************************************************************************************/

/**********************************************************************************************************************
 *  GLOBAL FUNCTIONS
 *********************************************************************************************************************/

void SystickEnable (void)
{
  NVIC_ST_CTRL_R = 0x0000000;
  NVIC_ST_CURRENT_R = 0;
  NVIC_ST_CTRL_R = 0x05;
}

void SystickDisable (void)
{
  NVIC_ST_CTRL_R = 0x00;
}


void SystickPeriodSet(uint32 uin32Period)
{
  volatile uint32 tick = 0;
  tick = ((uin32Period / (F_CPU/2000)))-1 ;
  NVIC_ST_RELOAD_R = tick ;
}

uint8 Systick_Is_Time_out(void)
{
  uint8 value = 0 ;
  if (GET_BIT(NVIC_ST_CTRL_R,16) == 0)
  {
    value = 0;
  }
  else 
  {
    NVIC_ST_CURRENT_R = 0x00;
    value = 1 ;
  }
  return value;
}

uint32 GetValue()
{
return NVIC_ST_CURRENT_R;
}

uint32 GetPeriod()
{
uint32 time = (NVIC_ST_CURRENT_R+1)*F_CPU;
return time;
}

void SysDelays(uint32 time)
{
SystickPeriodSet(time);
while(Systick_Is_Time_out() == 0);
}

/**********************************************************************************************************************
 *  END OF FILE: SYSTICK.c
 *********************************************************************************************************************/
